# Day 061: Init Containers in Kubernetes

**Time**: 15 minutes

## Objective
There are some applications that need to be deployed on Kubernetes cluster and these apps have some pre-requisites where some configurations need to be changed before deploying the app container. Some of these changes cannot be made inside the images so the DevOps team has come up with a solution to use init containers to perform these tasks during deployment. Below is a sample scenario that the team is going to test first.

Create a `Deployment` named as `ic-deploy-datacenter`.

Configure `spec` as replicas should be `1`, labels `app` should be `ic-datacenter`, template's metadata lables app should be the same `ic-datacenter`.

The `initContainers` should be named as `ic-msg-datacenter`, use image `fedora` with `latest` tag and use command `'/bin/bash'`, `'-c'` and `'echo Init Done - Welcome to xFusionCorp Industries > /ic/blog'`. The volume mount should be named as `ic-volume-datacenter` and mount path should be `/ic`.

Main container should be named as `ic-main-datacenter`, use image `fedora` with `latest` tag and use command `'/bin/bash'`, `'-c'` and `'while true; do cat /ic/blog; sleep 5; done'`. The volume mount should be named as `ic-volume-datacenter` and mount path should be `/ic`.

Volume to be named as `ic-volume-datacenter` and it should be an `emptyDir` type.

## Technologies Used
- `kubectl`
- `vi`

## Steps

1. Create the deployment manifest file. Reference [061-deployment.yaml](../configs/061-deployment.yaml)

    ```
    thor@jumphost ~$ vi deployment.yaml
    ```

3. Apply the deployment manifest

    ```
    thor@jumphost ~$ k apply -f deployment.yaml 
    deployment.apps/ic-deploy-datacenter created
    ```

4. Verify the deployment and pods are running

    ```
    thor@jumphost ~$ k get deployments.apps 
    NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
    ic-deploy-datacenter   1/1     1            1           24s
    ```

    ```
    thor@jumphost ~$ k get pods
    NAME                                    READY   STATUS    RESTARTS   AGE
    ic-deploy-datacenter-5955bd9f57-p94p5   1/1     Running   0          30s
    ```

5. Check the logs to verify the init container wrote the message and the main container is reading it

    ```
    thor@jumphost ~$ k logs pod/ic-deploy-datacenter-5955bd9f57-p94p5 
    Defaulted container "ic-main-datacenter" out of: ic-main-datacenter, ic-msg-datacenter (init)
    Init Done - Welcome to xFusionCorp Industries
    Init Done - Welcome to xFusionCorp Industries
    Init Done - Welcome to xFusionCorp Industries
    ```

## Key Takeaways
- Use examples in Kubernetes documents until they get you as far as you can get, modify them to meet your needs.
