# Day 018: Configure LAMP server

**Time**: 33 minutes

## Objective
xFusionCorp Industries is planning to host a `WordPress` website on their infra in `Stratos Datacenter`. 

They have already done infrastructure configurationâ€”for example, on the storage server they already have a shared directory `/var/www/html` that is mounted on each app host under `/var/www/html` directory. 

Please perform the following steps to accomplish the task:
- Install `httpd`, `php` and its dependencies on all app hosts.
- Apache should serve on port `5004` within the apps.
- Install/Configure `MariaDB server` on DB Server.
- Create a database named `kodekloud_db8` and create a database user named `kodekloud_sam` identified as password `YchZHRcLkL`. Further make sure this newly created user is able to perform all operation on the database you created.
- Finally you should be able to access the website on LBR link, by clicking on the `App` button on the top bar. You should see a message like `App is able to connect to the database using user kodekloud_sam`

## Technologies Used
- Apache HTTPD
- PHP (including MySQL/MariaDB extension)
- MariaDB Server
- systemd

## Steps

1. SSH into each app host in separate tabs, install software

    ```bash
    thor@jumphost ~$ ssh tony@stapp01
    [tony@stapp01 ~]$

    thor@jumphost ~$ ssh steve@stapp02
    [steve@stapp02 ~]$ 

    thor@jumphost ~$ ssh banner@stapp03
    [banner@stapp03 ~]$

    # In each of these tabs, install necessary software
    [tony@stapp01 ~]$ sudo yum install httpd php php-mysqli -y
    [steve@stapp02 ~]$ sudo yum install httpd php php-mysqli -y
    [banner@stapp03 ~]$ sudo yum install httpd php php-mysqli -y
    ```

2. Change port that Apache is served on from `80` to `5004` and restart the Apache service

    ```bash
    # Configure stapp01
    [tony@stapp01 ~]$ sudo cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.bak
    [tony@stapp01 ~]$ sudo sed -i 's/\<80\>/5004/g' /etc/httpd/conf/httpd.conf
    [tony@stapp01 ~]$ sudo systemctl enable httpd
    [tony@stapp01 ~]$ sudo systemctl start httpd

    # Configure stapp02
    [steve@stapp02 ~]$ sudo cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.bak
    [steve@stapp02 ~]$ sudo sed -i 's/\<80\>/5004/g' /etc/httpd/conf/httpd.conf
    [steve@stapp02 ~]$ sudo systemctl enable httpd
    [steve@stapp02 ~]$ sudo systemctl start httpd

    # Configure stapp03
    [banner@stapp03 ~]$ sudo cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.bak
    [banner@stapp03 ~]$ sudo sed -i 's/\<80\>/5004/g' /etc/httpd/conf/httpd.conf
    [banner@stapp03 ~]$ sudo systemctl enable httpd
    [banner@stapp03 ~]$ sudo systemctl start httpd
    ```

3. Install `mariadb-server` on database server, create user and permissions

    ```sh
    # SSH to DB server:
    thor@jumphost ~$ ssh peter@stdb01
    [peter@stdb01 ~]$

    # Install and enable mariadb
    [peter@stdb01 ~]$ sudo yum install mariadb-server -y
    [peter@stdb01 ~]$ sudo systemctl enable mariadb
    [peter@stdb01 ~]$ sudo systemctl start mariadb

    # Create user and permissions
    [peter@stdb01 ~]$ sudo mysql -u root -p
    # Enter password: <Press Enter>
    MariaDB [(none)]> CREATE DATABASE kodekloud_db8;
    MariaDB [(none)]> CREATE USER 'kodekloud_sam'@'%' IDENTIFIED BY 'YchZHRcLkL';
    MariaDB [(none)]> GRANT ALL ON kodekloud_db8.* TO 'kodekloud_sam'@'%';
    MariaDB [(none)]> exit

    # Attempt to connect using App button in upper right
    ```

## Key Takeaways
- How to configure Apache to listen on a non-default port
- How to create a MariaDB database and user with proper privileges
