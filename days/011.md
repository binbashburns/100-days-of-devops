# Day 011: Install and Configure Tomcat Server

**Time**: 29 minutes

## Objective
- Install `tomcat` server on `App Server 2`.
- Configure it to run on port `5000`.
- There is a `ROOT.war` file on `Jump host` at location `/tmp`.
- Deploy it on this `tomcat` server and make sure the webpage works directly on base URL i.e `curl http://stapp02:5000`

## Technologies Used
- package management (`yum`)
- `tree`
- `find`
- `systemctl`
- `tomcat`

## Steps

1. SSH into `stapp02` server

    ```bash
    thor@jumphost ~$ ssh steve@stapp02
    [steve@stapp02 ~]$
    ```

2. Install and configure Tomcat server on `stapp02`

    ```bash
    # Install `tomcat`
    [steve@stapp02 ~]$ sudo yum install tomcat -y

    # Try to remember where server.conf is located:
    [steve@stapp02 ~]$ sudo yum install tree -y
    [steve@stapp02 ~]$ tree /etc/tomcat/
    /etc/tomcat/
    ├── Catalina
    │   └── localhost
    ├── catalina.policy
    ├── catalina.properties
    ├── conf.d
    │   ├── README
    │   └── java-9-start-up-parameters.conf
    ├── context.xml
    ├── jaspic-providers.xml
    ├── jaspic-providers.xsd
    ├── logging.properties
    ├── server.xml
    ├── tomcat-users.xml
    ├── tomcat-users.xsd
    ├── tomcat.conf
    └── web.xml

    # Edit server.conf, change 8080s to the port defined in the instructions, which is 5000
    [steve@stapp02 ~]$ sudo vi /etc/tomcat/server.xml

    # Once you have changed this line:
    # <Connector port="8080" protocol="HTTP/1.1"
    # To this:
    # <Connector port="5000" protocol="HTTP/1.1"

    # Enable and start tomcat
    [steve@stapp02 ~]$ sudo systemctl enable tomcat
    [steve@stapp02 ~]$ sudo systemctl start tomcat

    # You can verify it is up and running in a different terminal:
    thor@jumphost ~$ curl http://stapp02:5000
    ```

3. Grab ROOT.war from jump host, move it to `stapp02`'s `webapp` folder

    ```bash
    # First, we need to find where the webapp folder is on stapp02:
    [steve@stapp02 ~]$ find / -iname *webapp* 2>/dev/null
    /var/lib/tomcat/webapps
    /usr/share/tomcat/webapps

    # We can copy this to both directories, looks like one is for defaults, one is for user-deployed applications.

    # First, on jumphost, lets secure copy the file to stapp02
    thor@jumphost ~$ sudo scp /tmp/ROOT.war steve@stapp02:
    ROOT.war               100% 4529     5.5MB/s   00:00

    # This dropped the file in the steve home directory
    [steve@stapp02 ~]$ ls -la
    total 36
    drwx------ 1 steve steve 4096 Dec  3 10:15 .
    drwxr-xr-x 1 root  root  4096 Jun  5  2024 ..
    -rw-r--r-- 1 steve steve   18 Feb 15  2024 .bash_logout
    -rw-r--r-- 1 steve steve  141 Feb 15  2024 .bash_profile
    -rw-r--r-- 1 steve steve  492 Feb 15  2024 .bashrc
    -rw-r--r-- 1 steve steve 4529 Dec  3 10:15 ROOT.war

    # Now we copy it to the two directories we found earlier:
    [steve@stapp02 ~]$ sudo cp ROOT.war /var/lib/tomcat/webapps
    [steve@stapp02 ~]$ sudo cp ROOT.war /usr/share/tomcat/webapps
    ```

4. Restart Tomcat and attempt to curl the page

    ```bash
    # Restart tomcat
    [steve@stapp02 ~]$ sudo systemctl restart tomcat

    # Curl, from jumphost
    thor@jumphost ~$ curl http://stapp02:5000
    # <!DOCTYPE html>
    # <!--
    # To change this license header, choose License Headers in Project Properties.
    # To change this template file, choose Tools | Templates
    # and open the template in the editor.
    # -->
    # <html>
    #     <head>
    #         <title>SampleWebApp</title>
    #         <meta charset="UTF-8">
    #         <meta name="viewport" content="width=device-width, initial-scale=1.0">
    #     </head>
    #     <body>
    #         <h2>Welcome to xFusionCorp Industries!</h2>
    #         <br>    
    #     </body>
    # </html>
    ```

## Key Takeaways
- It's always important to take the time to do simple Google searches for `where is <some configuration> located for <tool>`
- Be patient, make sure services are listening each step of the way. Verify functionality. After all, that's what we're being paid for as DevOps professionals: functional applications. :)