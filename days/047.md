# Day 047: Docker Python App

**Time**: 9 minutes

## Objective
A python app needed to be Dockerized, and then it needs to be deployed on `App Server 1`. We have already copied a requirements.txt file (having the app dependencies) under `/python_app/src/` directory on `App Server 1`. Further complete this task as per details mentioned below:

Create a `Dockerfile` under `/python_app` directory:

- Use any `python` image as the base image.
- Install the dependencies using `requirements.txt` file.
- Expose the port `3002`.
- Run the `server.py` script using `CMD`.

Build an image named `nautilus/python-app` using this Dockerfile.


Once image is built, create a container named `pythonapp_nautilus`:

Map port `3002` of the container to the host port `8094`.

Once deployed, you can test the app using `curl` command on `App Server 1`.

## Technologies Used
- `ssh`
- `vi`
- `docker`
- `curl`

## Steps

1. SSH into `stapp01` server, create Dockerfile

    ```bash
    # SSH to stapp01
    thor@jumphost ~$ ssh tony@stapp01

    # change directories
    [tony@stapp01 ~]$ cd /python_app/

    # init Dockerfile
    [tony@stapp01 python_app]$ sudo vi Dockerfile

    # print Dockerfile to terminal so you can see what I used for my lab
    [tony@stapp01 python_app]$ cat Dockerfile 

    FROM python:3.15.0a3-slim-trixie

    WORKDIR /app

    COPY ./src/* /app/

    RUN pip install -r requirements.txt

    EXPOSE 3002

    CMD ["python", "server.py"]
    ```

2. Attempt to build it, but it doesn't freaking work, so I have to manually pull the container for some reason first, then re-attempt

    ```bash
    # Attempt to build it, but it doesnt freaking work
    [tony@stapp01 python_app]$ docker build .
    # [+] Building 26.6s (2/2) FINISHED                docker:default
    # => [internal] load build definition from Dockerfile       0.0s
    # => => transferring dockerfile: 185B                       0.0s
    # => CANCELED [internal] load metadata for docker.io/libr  26.6s
    # ERROR: failed to build: failed to solve: Canceled: context canceled

    # so I have to manually pull the container for some reason first
    [tony@stapp01 python_app]$ sudo docker pull 3.15.0a3-slim-trixie

    # then re-attempt
    [tony@stapp01 python_app]$ sudo docker build -t nautilus/python-app .
    ```

3. Run the container

    ```bash
    # Run the container
    [tony@stapp01 python_app]$ docker run -d --name pythonapp_nautilus -p 8094:3002 nautilus/python-app

    # Optionally, in another tab, run curl to verify
    thor@jumphost ~$ curl stapp01:8094
    ```

## Key Takeaways
- If you get stuck on `docker build`, try pulling the container locally first. Some weird lab bug.
