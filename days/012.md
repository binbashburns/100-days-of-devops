# Day 012: Linux Network Services

**Time**: 34 minutes

## Objective
Our monitoring tool has reported an issue in Stratos Datacenter. One of our app servers has an issue, as its Apache service is not reachable on port 5001 (which is the Apache port). The service itself could be down, the firewall could be at fault, or something else could be causing the issue.

- Use tools like telnet, netstat, etc. to find and fix the issue. Also make sure Apache is reachable from the jump host without compromising any security settings.

- Once fixed, you can test the same using command curl http://stapp01:5001 command from jump host.

- Note: Please do not try to alter the existing index.html code, as it will lead to task failure.

## Technologies Used
- `curl`
- `netstat`
- `kill`
- `systemctl`
- `iptables`

## Steps

1. Determine which server has the problem, then SSH to it:

    ```bash
    thor@jumphost ~$ curl http://stapp01:5001 | head
    curl: (7) Failed to connect to stapp01 port 5021: No route to host

    # This means it is stapp01 that is having an issue. Lets SSH to it
    thor@jumphost ~$ ssh tony@stapp01
    ```

2. Let's find out if there is another service listening on 5001 on this machine.

    ```bash
    # Check for services running on port 5001
    [tony@stapp01 ~]$ sudo netstat -tulpn | grep 5001
    tcp 0 0 127.0.0.1:5001  0.0.0.0:*  LISTEN  480/sendmail: accep

    # I am going to try to kill that sendmail service, using the PID it gave me
    [tony@stapp01 ~]$ sudo kill 480
    [tony@stapp01 ~]$ sudo netstat -tulpn | grep 5001
    [tony@stapp01 ~]$
    ```

3. Let's try restarting Apache (`httpd`) now, and seeing if we can curl it again:

    ```bash
    # Restart httpd
    [tony@stapp01 ~]$ sudo systemctl restart httpd

    # Check the status of it now
    [tony@stapp01 ~]$ sudo systemctl status httpd
    # ‚óè httpd.service - The Apache HTTP Server
    # Loaded: loaded (/usr/lib/systemd/system/httpd.service;
    # disabled; vendor preset: disabled)
    # Active: active (running) since Wed 2025-12-
    # 03 12:39:58 UTC; 47s ago

    # Try to curl it
    thor@jumphost ~$ curl http://stapp01:5001
    curl: (7) Failed to connect to stapp01 port 5001: No route to host
    ```

4. Should've done this first, but let's find out where apache is listening, and whether there may be something else blocking the connection

    ```bash
    # look for port httpd is listening on
    [tony@stapp01 ~]$ sudo netstat -tulpn | grep httpd
    tcp        0      0 0.0.0.0:5001            0.0.0.0:*               LISTEN      1170/httpd

    # Its listening on the right port. Are we blocking it with iptables?
    [tony@stapp01 ~]$ sudo iptables -L -n --line-numbers
    Chain INPUT (policy ACCEPT)
    num  target     prot opt source               destination         
    1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    2    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           
    3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
    4    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:22
    5    REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited

    Chain FORWARD (policy ACCEPT)
    num  target     prot opt source               destination         
    1    REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited

    Chain OUTPUT (policy ACCEPT)
    num  target     prot opt source               destination

    # I know it isnt best practice, but I will add a 5001 INPUT accept rule at the top of iptables
    [tony@stapp01 ~]$ sudo iptables -I INPUT 1 -p tcp --dport 5001 -j ACCEPT

    # And test again from jumphost:
    thor@jumphost ~$ curl http://stapp01:5001 | head -n 5
    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                    Dload  Upload   Total   Spent    Left  Speed
    0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0<!DOCTYPE html>
    <html lang="en">
    <head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.7.28">
    <title>HTTP Server Test Page powered by CentOS</title>
    34  195k   34 69248    0     0  66.0M      0 --:--:-- --:--:-- --:--:-- 66.0M

    # The above output shows we have successfully opened 5001 and the exercise is complete

    ```

## Key Takeaways
- The issue might not be a single thing. The issue might have multiple layers. In this lesson, we first tried making sure there wasn't a service blocking the port, which we found to be correct. It also had a second issue, which was the iptables ruleset
