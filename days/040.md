# Day 040: Docker EXEC Operations

**Time**: 15 minutes

## Objective
One of the Nautilus DevOps team members was working to configure services on a `kkloud` container that is running on `App Server 2` in `Stratos Datacenter`. Due to some personal work he is on PTO for the rest of the week, but we need to finish his pending work ASAP. Please complete the remaining work as per details given below:
- Install `apache2` in `kkloud` container using `apt` that is running on `App Server 2` in `Stratos Datacenter`.
- Configure Apache to listen on port `8083` instead of default `http` port. Do not bind it to listen on specific IP or hostname only, i.e it should listen on localhost, 127.0.0.1, container ip, etc.
- Make sure Apache service is up and running inside the container. Keep the container in running state at the end.

## Technologies Used
- `ssh`
- `docker exec`
- `apt`
- `apache2`
- `apachectl`
- `sed`
- `curl`

## Steps

1. SSH into `stapp02` server as `steve`

    ```bash
    # Connect to App Server 2
    thor@jumphost ~$ ssh steve@stapp02
    ```

2. Identify the running container (`kkloud`)

    ```bash
    # List running containers and confirm kkloud is up
    [steve@stapp02 ~]$ docker ps
    ```

3. Exec into the container shell

    ```bash
    # Enter the container as root
    [steve@stapp02 ~]$ docker exec -it kkloud /bin/bash
    ```

4. Install Apache2 inside the container

    ```bash
    # Install apache2 using apt
    root@7b6ac69a184a:/# apt install apache2 -y
    ```

5. Update Apache to listen on port `8083` (not bound to a specific IP)

    ```bash
    # Preview the change: replace standalone 80 with 8083 in ports.conf
    root@7b6ac69a184a:/# sed 's/\b80\b/8083/g' /etc/apache2/ports.conf
    ```

    ```bash
    # Apply the change in-place
    root@7b6ac69a184a:/# sed -i 's/\b80\b/8083/g' /etc/apache2/ports.conf
    ```

    ```bash
    # Preview the vhost change: update VirtualHost *:80 to *:8083
    root@7b6ac69a184a:/# sed 's/\b80\b/8083/g' /etc/apache2/sites-enabled/000-default.conf
    ```

    ```bash
    # Apply the vhost change in-place
    root@7b6ac69a184a:/# sed -i 's/\b80\b/8083/g' /etc/apache2/sites-enabled/000-default.conf
    ```

6. Start Apache inside the container (no systemd available)

    ```bash
    # Start apache using apache2ctl (systemctl is not available in this container)
    root@7b6ac69a184a:/# /usr/sbin/apache2ctl start
    ```

    ```bash
    # Confirm systemctl is not present (expected in minimal containers)
    root@7b6ac69a184a:/# systemctl status apache2
    ```

7. Validate Apache is running and responding on `8083`

    ```bash
    # Verify apache processes are running
    root@7b6ac69a184a:/# ps aux | grep apache
    ```

    ```bash
    # Confirm the default site responds on the new port
    root@7b6ac69a184a:/# curl localhost:8083
    ```

## Key Takeaways
- In containers, `systemctl` often is not available; use `apache2ctl` (or run apache in the foreground) instead.
- Changing the listen port usually requires updating both `ports.conf` and the active `VirtualHost` config.
