# Day 054: Kubernetes Shared Volumes

**Time**: 15 minutes

## Objective
We are working on an application that will be deployed on multiple containers within a pod on Kubernetes cluster. There is a requirement to share a volume among the containers to save some temporary data. The Nautilus DevOps team is developing a similar template to replicate the scenario. Below you can find more details about it.

Create a pod named `volume-share-devops`.

For the first container, use image `fedora` with `latest` tag only and remember to mention the tag i.e `fedora:latest`, container should be named as `volume-container-devops-1`, and run a `sleep` command for it so that it remains in running state. Volume `volume-share` should be mounted at path `/tmp/beta`.

For the second container, use image `fedora` with the `latest` tag only and remember to mention the tag i.e `fedora:latest`, container should be named as `volume-container-devops-2`, and again run a `sleep` command for it so that it remains in running state. Volume `volume-share` should be mounted at path `/tmp/demo`.

Volume name should be `volume-share` of type `emptyDir`.

After creating the pod, exec into the first container i.e `volume-container-devops-1`, and just for testing create a file `beta.txt` with any content under the mounted path of first container i.e `/tmp/beta`.

The file `beta.txt` should be present under the mounted path `/tmp/demo` on the second container `volume-container-devops-2` as well, since they are using a shared volume.


## Technologies Used
- `kubectl`
- `vi`

## Steps

1. Create a pod manifest with two containers sharing an emptyDir volume.

    ```bash
    thor@jumphost ~$ vi pod.yaml
    thor@jumphost ~$ cat pod.yaml 
    apiVersion: v1
    kind: Pod
    metadata:
      name: volume-share-devops
    spec:

      restartPolicy: Never

      volumes:
      - name: volume-share
        emptyDir: {}

      containers:

      - name: volume-container-devops-1
        image: fedora:latest
        volumeMounts:
        - name: volume-share
          mountPath: /tmp/beta
        command: ["sleep"]
        args: ["600"]

      - name: volume-container-devops-2
        image: fedora:latest
        volumeMounts:
        - name: volume-share
          mountPath: /tmp/demo
        command: ["sleep"]
        args: ["600"]
    ```

2. Apply the manifest to create the pod.

    ```bash
    thor@jumphost ~$ k apply -f pod.yaml 
    pod/volume-share-devops created
    ```

3. Verify the pod is running.

    ```bash
    thor@jumphost ~$ k get pod
    NAME                  READY   STATUS    RESTARTS   AGE
    volume-share-devops   2/2     Running   0          4s
    ```

4. Exec into the first container and create a test file in the shared volume.

    ```bash
    thor@jumphost ~$ kubectl exec -it pods/volume-share-devops -c volume-container-devops-1 -- /bin/bash
    [root@volume-share-devops /]# echo "hey" > /tmp/beta/beta.txt
    [root@volume-share-devops /]# ls -la /tmp/beta/
    total 12
    drwxrwxrwx 2 root root 4096 Jan 16 11:43 .
    drwxrwxrwt 1 root root 4096 Jan 16 11:40 ..
    -rw-r--r-- 1 root root    4 Jan 16 11:43 beta.txt
    [root@volume-share-devops /]# exit
    exit
    ```

5. Exec into the second container and verify the file exists at the mounted path.

    ```bash
    thor@jumphost ~$ kubectl exec -it pods/volume-share-devops -c volume-container-devops-2 -- /bin/bash
    [root@volume-share-devops /]# ls -la /tmp/demo/
    total 12
    drwxrwxrwx 2 root root 4096 Jan 16 11:43 .
    drwxrwxrwt 1 root root 4096 Jan 16 11:40 ..
    -rw-r--r-- 1 root root    4 Jan 16 11:43 beta.txt
    [root@volume-share-devops /]# exit
    exit
    ```

## Key Takeaways
- I found a Kubernetes docs example that is about 80% of what you need here, at around the top of this page: https://kubernetes.io/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/
