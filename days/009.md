# Day 009: MariaDB Troubleshooting

**Time**: 10 minutes

## Objective
- There is a critical issue going on with the `Nautilus` application in `Stratos DC`. 
- The production support team identified that the application is unable to connect to the database. 
- After digging into the issue, the team found that `mariadb` service is down on the database server.
- Look into the issue and fix it.

## Technologies Used
- `systemctl`
- `journalctl`
- `chown`

## Steps

1. SSH into stdb01 server

    ```bash
    thor@jumphost ~$ ssh peter@stdb01
    [peter@stdb01 ~]$
    ```

2. View status of `mariadb` and try to bounce it

    ```bash
    # Check status of mariadb using systemctl
    [peter@stdb01 ~]$ sudo systemctl status mariadb

    We trust you have received the usual lecture from the local System
    Administrator. It usually boils down to these three things:

        #1) Respect the privacy of others.
        #2) Think before you type.
        #3) With great power comes great responsibility.

    [sudo] password for peter: 

    ○ mariadb.service - MariaDB 10.5 database server
        Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled; preset: disabled)
        Active: inactive (dead) since Tue 2025-12-02 08:57:57 UTC; 3min 59s ago
    ...
        Status: "MariaDB server is down"
    ...
    Dec 02 08:57:57 stdb01.stratos.xfusioncorp.com systemd[1]: mariadb.service: Job 112 mariadb.service/stop finished, result=done
    Dec 02 08:57:57 stdb01.stratos.xfusioncorp.com systemd[1]: Stopped MariaDB 10.5 database server.

    # Attempt to bounce it
    [peter@stdb01 ~]$ sudo systemctl restart mariadb
    Job for mariadb.service failed because the control process exited with error code.

    See "systemctl status mariadb.service" and "journalctl -xeu mariadb.service" for details.
    ```

3. Check `journalctl` logs

    ```bash
    [peter@stdb01 ~]$ sudo journalctl -xeu mariadb.service
    
    ...
    
    Dec 02 09:04:09 stdb01.stratos.xfusioncorp.com mariadbd[2348]: 2025-12-02  9:04:09 0 [Warning] Can't create test file '/var/lib/mysql/stdb01.lower-test' (Errcode: 13 "Permission denied")

    ...
    
    ░░ Subject: A start job for unit mariadb.service has failed
    ░░ Defined-By: systemd
    ░░ Support: https://access.redhat.com/support
    ░░ 
    ░░ A start job for unit mariadb.service has finished with a failure.
    ░░ 
    ░░ The job identifier is 238 and the job result is failed.
    Dec 02 09:04:10 stdb01.stratos.xfusioncorp.com systemd[1]: mariadb.service: Unit entered failed state.
    
    ```
4. From `journalctl` logs, looks like `mariadb` is trying to write to `/var/lib/mysql/` and it was denied permission to do so. Let's look at permissions on `/var/lib/mysql/` and see if we can fix it.

    ```bash
    # Checking permissions, using ls -la
    [peter@stdb01 ~]$ ls -la /var/lib/
    total 68
    ...
    drwxr-xr-x 1 root mysql 4096 Dec  2 08:57 mysql
    ...

    # It says `root mysql`, should be `mysql mysql`. Let's change that with chown:
    [peter@stdb01 ~]$ sudo chown mysql:mysql /var/lib/mysql/
    
    # Let's verify changes worked correctly
    [peter@stdb01 ~]$ ls -la /var/lib/
    total 68
    ...
    drwxr-xr-x 1 mysql mysql 4096 Dec  2 08:57 mysql.
    ...

    # And bounce mariadb once again:
    [peter@stdb01 ~]$ sudo systemctl restart mariadb
    [peter@stdb01 ~]$ sudo systemctl status mariadb
    ● mariadb.service - MariaDB 10.5 database server
        Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled; preset: disabled)
        Active: active (running) since Tue 2025-12-02 09:14:04 UTC; 4s ago

    # MariaDB is now showing ACTIVE, we're good!

    ```

## Key Takeaways
- Read what `systemctl` is telling you. On this one, it told you exactly where to go: `journalctl` logs, and `journalctl` logs led us to the next clue.
