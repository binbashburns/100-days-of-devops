# Day 015: Setup SSL for Nginx

**Time**: 21 minutes

## Objective
The system admins team of `xFusionCorp Industries` needs to deploy a new application on `App Server 1` in `Stratos Datacenter`. They have some pre-requites to get ready that server for application deployment. Prepare the server as per requirements shared below:

- Install and configure `nginx` on `App Server 1`.
- On `App Server 1` there is a self signed SSL certificate and key present at location `/tmp/nautilus.crt` and `/tmp/nautilus.key`. Move them to some appropriate location and deploy the same in Nginx.
- Create an `index.html` file with content `Welcome!` under Nginx document root.
- For final testing try to access the `App Server 1` link (either hostname or IP) from `jump host` using `curl`. For example `curl -Ik https://<app-server-ip>/`.

## Technologies Used
- `nginx`
- OpenSSL/self-signed certificates
- `systemd`
- `curl`

## Steps

1. SSH into `stapp01` server

    ```bash
    thor@jumphost ~$ ssh tony@stapp01
    ```

2. Install nginx and add an `index.html`

    ```bash
    # Install `nginx`
    [tony@stapp01 ~]$ sudo yum install nginx -y

    # Modify index.html
    [tony@stapp01 ~]$ sudo mv /usr/share/nginx/html/index.html /usr/share/nginx/html/index.html.bkp
    [tony@stapp01 ~]$ sudo vi /usr/share/nginx/html/index.html
    # (Add: "Welcome!", then save and exit)

    # Restart NGINX
    [tony@stapp01 ~]$ sudo systemctl restart nginx

    # In another terminal, verify page can be read from jumphost:
    thor@jumphost ~$ curl http://stapp01
    # Welcome!
    ```

3. Move /tmp/nautilus.crt and /tmp/nautilus.key to wherever nginx is looking for certs

    ```bash
    # To find out where NGINX expects certs to be located, lets check the nginx.conf:
    [tony@stapp01 ~]$ sudo cat /etc/nginx/nginx.conf | tail -n 30
    # Settings for a TLS enabled server.
    #
    #    server {
    #        listen       443 ssl http2;
    #        listen       [::]:443 ssl http2;
    #        server_name  _;
    #        root         /usr/share/nginx/html;
    #
    #        ssl_certificate "/etc/pki/nginx/server.crt";
    #        ssl_certificate_key "/etc/pki/nginx/private/server.key";
    #        ssl_session_cache shared:SSL:1m;
    #        ssl_session_timeout  10m;
    #        ssl_ciphers PROFILE=SYSTEM;
    #        ssl_prefer_server_ciphers on;
    #
    #        # Load configuration files for the default server block.
    #        include /etc/nginx/default.d/*.conf;
    #
    #        error_page 404 /404.html;
    #            location = /40x.html {
    #        }
    #
    #        error_page 500 502 503 504 /50x.html;
    #            location = /50x.html {
    #        }
    #    }

    # Lets move the certs there
    [tony@stapp01 ~]$ sudo mv /tmp/nautilus.crt /etc/pki/nginx/server.crt
    # mv: cannot move '/tmp/nautilus.crt' to '/etc/pki/nginx/server.crt': No such file or directory

    # Ope, need to make the directories:
    [tony@stapp01 ~]$ sudo mkdir -p /etc/pki/nginx/
    [tony@stapp01 ~]$ sudo mkdir -p /etc/pki/nginx/private

    # Try again:
    [tony@stapp01 ~]$ sudo mv /tmp/nautilus.crt /etc/pki/nginx/server.crt
    [tony@stapp01 ~]$ sudo mv /tmp/nautilus.key /etc/pki/nginx/private/server.key

    ```

4. Modify nginx.conf, test and restart nginx, curl again

    ```bash
    # Uncomment this:
    #    server {
    #        listen       443 ssl http2;
    #        listen       [::]:443 ssl http2;
    #        server_name  _;
    #        root         /usr/share/nginx/html;
    #
    #        ssl_certificate "/etc/pki/nginx/server.crt";
    #        ssl_certificate_key "/etc/pki/nginx/private/server.key";
    #        ssl_session_cache shared:SSL:1m;
    #        ssl_session_timeout  10m;
    #        ssl_ciphers PROFILE=SYSTEM;
    #        ssl_prefer_server_ciphers on;
    #
    #        # Load configuration files for the default server block.
    #        include /etc/nginx/default.d/*.conf;
    #
    #        error_page 404 /404.html;
    #            location = /40x.html {
    #        }
    #
    #        error_page 500 502 503 504 /50x.html;
    #            location = /50x.html {
    #        }
    #    }

    [tony@stapp01 ~]$ sudo vi /etc/nginx/nginx.conf

    # (uncomment stuff listed above so ssl is enabled)

    # Test nginx.conf
    [tony@stapp01 ~]$ sudo nginx -t
    # nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
    # nginx: configuration file /etc/nginx/nginx.conf test is successful

    # Restart NGINX
    [tony@stapp01 ~]$ sudo systemctl restart nginx

    # Curl it
    thor@jumphost ~$ curl -Ik https://stapp01
    # HTTP/2 200 
    # server: nginx/1.20.1
    # date: Sat, 06 Dec 2025 23:31:31 GMT
    # content-type: text/html
    # content-length: 9
    # last-modified: Sat, 06 Dec 2025 23:19:44 GMT
    # etag: "6934ba10-9"
    # accept-ranges: bytes
    ```

## Key Takeaways
- How to enable HTTPS in Nginx using a self-signed certificate
- How to validate Nginx SSL configuration and test with curl
